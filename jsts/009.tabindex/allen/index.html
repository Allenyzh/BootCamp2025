<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tab Index</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <main class="d-flex flex-column gap-4 align-items-center pt-3 vh-100">
      <ul class="nav nav-underline">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#" data-task="0"
            >Task 0 - Default</a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-task="1">Task 1 - Single Form</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-task="2">Task 2 - Cross Form</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-task="3">Task 3 - Form Loop</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-task="4">Task 4 - Same Name</a>
        </li>
      </ul>

      <div id="formArea" class="d-flex flex-column gap-4"></div>
    </main>

    <script>
      const navLinks = document.querySelectorAll(".nav-link");

      document.addEventListener("DOMContentLoaded", function () {
        const defaultLink = document.querySelector('.nav-link[data-task="0"]');
        if (defaultLink) {
          defaultLink.click();
        }
      });

      navLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();

          // 切换 active 样式
          navLinks.forEach((l) => l.classList.remove("active"));
          this.classList.add("active");

          const taskId = this.dataset.task;
          const filePath = `./components/Task${taskId}.html`;

          // 加载对应任务内容到 #formArea
          fetch(filePath)
            .then((response) => response.text())
            .then((html) => {
              document.getElementById("formArea").innerHTML = html;
              const formNameArea = document.getElementById("formNameArea");
              formNameArea.innerHTML = `<h4 class="mb-3">Task ${taskId}</h4>`;
            })
            .catch((error) => {
              console.error(`Error loading ${filePath}:`, error);
              document.getElementById(
                "formArea"
              ).innerHTML = `<p class="text-danger">Failed to load Task ${taskId}</p>`;
            });
        });
      });

      // Task 1 特定的 Tab 键行为
      document.addEventListener("keydown", function (e) {
        const isTask1Active = document.querySelector(
          '.nav-link.active[data-task="1"]'
        );
        if (!isTask1Active) return;

        const submitBtn = document.querySelector(
          'form[name="userform"] button[type="submit"]'
        );
        const target = document.querySelector(
          'form[name="userform"] input[name="name"]'
        );
        if (
          e.key === "Tab" &&
          document.activeElement === submitBtn &&
          !e.shiftKey &&
          target
        ) {
          e.preventDefault();
          target.focus();
        }

        if (
          e.key === "Tab" &&
          e.shiftKey &&
          document.activeElement === target
        ) {
          e.preventDefault();
          submitBtn.focus();
        }
      });

      // Task 2 特定的 Tab 键行为
      document.addEventListener("keydown", function (e) {
        const isTask2Active = document.querySelector(
          '.nav-link.active[data-task="2"]'
        );
        if (!isTask2Active) return;

        const submitBtn2 = document.querySelector(
          'form[name="userform2"] button[type="submit"]'
        );
        const target = document.querySelector(
          'form[name="userform1"] input[name="name"]'
        );

        if (
          e.key === "Tab" &&
          document.activeElement === submitBtn2 &&
          !e.shiftKey &&
          target
        ) {
          e.preventDefault();
          target.focus();
        }
        if (
          e.key === "Tab" &&
          e.shiftKey &&
          document.activeElement === target
        ) {
          e.preventDefault();
          submitBtn2.focus();
        }
      });
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
